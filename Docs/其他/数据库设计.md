1. 校园交易系统数据需求
   该系统共需要用到学生信息表、用户表、用户信用变更记录表、登录日志表、邮件验证表等二十张数据表。
   用户注册时需要与学生信息表中预存的信息比对，确保用户的学生身份。用户的相关信息存储在用户表中。如若用户进行邮箱绑定，邮箱验证需要用到邮件验证表，该表中存放待验证邮箱、验证码、过期时间等信息。用户的登录日志存放在登录日志表中。
   用户在进行交易时可能会涉及到账号信用分的变化，信用分变化的信息存放在用户信用变更记录表中。
   发布商品时，商品信息储存在商品表中，该表中同样包含后续加入的如浏览量之类的其他相关信息，用于商品自动下架决策。另外，如果用户上传了商品图片，商品图片的存储路径以及关联的商品会存储在商品图片表中。
   商品的各级分类信息存储在分类表中，分类表中包含分类 ID 和父分类 ID，通过父分类 ID 来识别当前分类的上级分类。
   用户在进行交易时的订单存放在订单表中。用户发起的换物请求的相关信息，包括提供的商品、请求的商品等都存放在换物请求信息表中。
   订单状态发送变化时会通知用户，相关的订单信息、以及通知内容模板都存储在通知信息表中，该表中还会记录发送状态，如若发送失败，则会继续尝试发送。
   用户在交易时用到的虚拟账户信息存放在虚拟账户表中，充值记录存放在充值记录表中。
   用户还可对交易订单进行评价或举报，内容分别存放在评价表和举报表中，举报时用户可以上传图片材料，与商品发布时的图片处理类似，这里的举报材料的相关信息、存储路径存放在举报证据表中。
   系统中管理员的权限通过管理员表赋予，管理员的用户信息依然存放在用户表中，管理员表存放该用户负责的商品分类和管理分工信息。
   管理员进行的重要操作，例如封禁用户、修改权限、举报处理等等，会记录在操作日志表中。
   1.1 用户注册与验证、用户注销功能数据需求
   需要用到学生信息表和用户表。
   用户需通过填写学号和姓名验证注册，系统比对预存的学生信息表，匹配通过方可注册成功。一个学生信息只允许注册一个账号，注册时系统也会检查用户表中是否已存在该学生信息的账号。
   1.2 用户信用功能数据需求
   需要用到用户表和用户信用变更记录表。
   用户进行的交易操作有可能影响其信用分，当用户信用分被更改时，系统会将包括变更类型以及分值的相关信息都记录在用户信用变更记录表中，并将用户表的 credit_score 字段更新为用户当前的信用分。
   1.3 登录日志与异常告警功能数据需求
   需要用到登录日志表。
   每次登录时，用户输入密码系统校验后，首先会通过认证中间件进行 JWT 令牌验证，然后通过审计中间件将登录信息存放在登录日志表中，包括登录时间、设备类型。
   接着风控中间件会区分风险等级，写入登录日志表中，并处理异常行为。
   1.4 账户安全绑定（邮箱绑定验证）需求
   需要用到邮件验证表。
   在发起一次账户安全绑定后，一个验证的实例便产生了，根据用户事先填写，并记录在验证实例中的电子邮箱号，系统向该邮箱发送一串 6 个数字的随机产生的验证码。在用户按时正确填写验证码后，验证宣告完成，其终止时间确定，关于验证是否使用完毕的记录也被改变。
   倘若一次验证失败（在规定时间内未正确填写验证码），用户可以申请下一次验证，系统再次向邮箱发送验证码，重复之前过程。
   1.5 商品发布需求
   需要用到商品表。
   对于每个发布的商品，系统通过特定的 id 作为唯一标识。在发布商品时，需要用户填写商品的具体信息，包括商品的标题，额外描述，所属品类，基础价格等信息。填写完成后，商品被确认发布，则一个商品的实例就此生成。
   在发布后，系统根据发布时的客观信息确定其自动下架时间，以及当前状态等基本信息，发布后，商品便可被其他用户看见。
   1.6 商品分类需求
   需要用到种类表、商品表。
   在发布一个商品时，需要为其选择分类，共三级分类：
   ·第一级：教材/数码/日用 对商品进行宏观层面的归类，将商品按照大的属性或使用场景划分，便于用户从整体上对商品进行初步筛选和定位，也方便平台进行管理和展示；
   ·第二级：按学科/类型细分 在一级分类的基础上进一步细化，用于在第一级的某一模块中具体更细致的方向；
   ·第三级：急出/可议价/支持换物 用于表明该商品的售卖状态和可能的售卖途径，为商品添加一些特殊属性或交易相关的标识。
   在 categories 表中，三级标签之间的传递通过 category_id 和 parent_id 来实现，对于某一级分类 ID（除第一级）记录它的上一级分类 ID，name 字段记录当前标签的具体名称。
   在 products 表中，对每一件商品记录相应的第三级标签 ID（category_id），使其关联到 categories 表，并能以此找到其上级的标签。
   1.7 智能下架需求
   需要用到商品表。
   下架时间计算的核心逻辑：对每个商品，根据其累计浏览量和上架天数判断是否需要调整下架时间。
   通过 Redis 实时记录商品浏览量（记录在 products 表的 view_count），每日定时将浏览数据同步至数据库，结合商品类型和预设规则自动计算下架时间（记录在 products 表的 auto_remove_time），实现商品的智能化、自动化管理，提升库存周转效率。
   自动下架执行也为定时任务，扫描 products 表中 status = “在售”且 当前日期 ≥ auto_remove_time 的商品。将符合条件的商品标记为 status = “已下架”，记录下架时间至日志表。
   1.8 订单状态通知需求
   需要用到通知信息表和订单表。
   在应用程序中，当订单表中的 status 字段发生变化时（比如从 “待支付” 变为 “已支付” ），触发通知逻辑。可以通过数据库触发器（如果数据库支持）或者在应用程序业务逻辑层进行监听。例如在后端代码中，每当更新订单状态的函数执行后，紧接着调用发送通知的函数。
   根据订单状态的变化生成对应的通知内容。比如订单状态变为 “已发货”，则通知内容可以是 “您的订单已发货，请注意查收” 。将订单的 order_id 以及生成的通知内容插入到通知信息表中，send_status 初始化为 “未发送”，retry_count 初始化为 0，last_attempt_time 初始化为当前时间。
   从通知信息表中获取 send_status 为 “未发送” 的记录，根据订单的 order_id 关联到订单表，获取买家相关信息，然后通过短信、邮件或者应用内消息等方式发送通知。发送成功后，更新通知信息表中的 send_status 为 “已发送”；如果发送失败，则更新 retry_count 加 1，并更新 last_attempt_time 为当前时间。
   设置一个策略，比如当 retry_count 达到一定次数（如 3 次）后不再重试，或者每隔一定时间（如 1 小时）对发送失败的通知进行重试。
   1.9 订单管理需求
   需要用到订单表和用户表。
   完整订单生命周期：待付款 → 已付款 → 已发货 → 已送达 → 已完成，涉及状态异常处理（如超时未付款自动取消）
   订单创建（待付款状态）：用户选择商品后提交订单，系统生成订单记录。在订单表中插入一条新记录，order_id 作为主键唯一标识订单，填充 buyer_id、seller_id、product_id、total_amount、create_time 等字段，status 字段设置为待付款，expire_time 根据业务规则（如 30 分钟后超时）计算并设置。
   订单付款（已付款状态）：用户完成支付操作，系统确认支付成功后更新订单状态。在支付成功回调接口或相关处理逻辑中，根据支付信息找到对应的 order_id，更新订单表中的 status 字段为已付款，同时可以更新 final_price（如有价格变动）。
   卖家发货（已发货状态）：卖家确认商品已发出，更新订单状态。卖家操作界面触发发货操作后，通过 order_id 更新订单表中的 status 为已发货。
   订单送达（已送达状态）：物流信息反馈商品已送达，或买家手动确认收货。若系统对接物流信息获取送达信息后或买家在系统操作确认收货时，根据 order_id 更新订单表中的 status 为已送达。
   订单完成（已完成状态）：订单送达一定时间后自动完成，或买家进行评价等操作后视为完成。可以设置定时任务，检查已送达状态且超过一定时间（如 3 天）的订单，更新其 status 为已完成；或者买家提交评价后，更新订单状态为已完成。
   状态异常处理 - 超时未付款自动取消：订单创建后超过设定的 expire_time 仍为待付款状态，自动取消订单。设置定时任务，定期检查订单表中 status 为待付款且当前时间超过 expire_time 的订单，将其 status 更新为已取消。
   1.10 模拟支付需求
   需要用到订单表、虚拟账户表、充值表。
   每个用户拥有唯一的虚拟账户，记录当前余额。支持余额查询、充值、付款等操作。用户通过支付宝沙箱环境进行模拟充值。系统记录每一笔充值请求及其处理状态（处理中、成功、失败），充值成功后更新虚拟账户余额。用户在订单提交时可选择使用虚拟余额进行支付。系统验证账户余额是否足够，若充足则扣除相应金额，订单状态变更为“已付款”。所有扣款操作需记录日志，确保资金操作可追溯。
   系统设定定时任务，定期扫描 orders 表中状态为“待付款”且已超过 expire_time 的订单。超时订单将自动取消，若有已冻结或扣除的虚拟账户金额，则回滚至买家账户。
   仅卖家可执行“发货”操作，且前提为订单状态为“已付款”。仅买家可执行“确认收货”操作，且前提为订单状态为“已送达”。
   1.11 议价请求与协商需求
   需要用到订单表、议价表。
   买家在商品订单页面点击“议价”按钮，弹出商品价格和议价输入框。买家可输入新的议价价格，点击提交后由后端校验价格有效性。若合法，则插入一条记录到 negotiations 表，状态为“等待回应”，同时向卖家推送实时通知。
   卖家收到议价通知后，可选择以下任一操作：
   • 接受：更新议价状态为“接受”，订单价格更新为议价价格；
   • 拒绝：更新状态为“拒绝”，交易按原价继续；
   • 反报价：卖家输入新的价格，插入新的议价记录，继续协商。
   协商支持多轮，直到一方接受或终止议价流程；所有议价记录均在数据库中存档，便于后期审查与追踪。
   1.12 换物交易管理需求
   需要用到换物请求表、商品表。
   支持用户发起换物请求，并明确交换物品内容（包含己方交换物品和对方交换物品）以及交换条件。
   换物需得到对方的同意，换物流程被全程跟踪。若换物请求未获得同意，则换物交易失败。
   1.13 多维评价体系评价需求
   需要用到订单表，评价表。
   订单完成后，用户可以进行评价，记录对订单的多维度评价反馈数据，支持匿名评价机制，保留完整的评价时间及商家响应记录，包括 ： 1.基础评价数据：评价 ID、关联订单号、总体评分（1-5 分制） 2.多维度评价指标：商品描述相符度、服务态度两项细分评分 3.用户行为特征：匿名状态标记（默认非匿名） 4.时空信息：评价创建时间戳 5.交互数据：商家针对用户评价的文本回复内容
   1.14 评价互动机制需求
   需要用到评价表。
   评价通过抽象订单关联到具体订单或是换物订单上，买家可对自己的订单进行评价，评价标准包括总体星级、描述相符度、服务态度三方面。并且用户可以选择是否匿名评论。
   卖家可以对买家的评价进行回应，存储到评价表中，隶属具体评价。
   1.15 举报分级处理需求
   需要用到举报表。
   收到举报后，管理系统根据举报类型、举报时间对举报进行评级。
   性质严重例如欺诈的具有高优先级，需要优先处理，对卖家的信誉也会产生更大的影响。
   1.16 举报材料上传需求
   需要用到举报表、举报证据表。
   用户在校园交易系统中遇到涉嫌违规或欺诈的订单时，可以通过举报功能发起申诉。举报时，用户需要填写举报类型、优先级及相关说明，同时可上传多份举证材料，如图片、截图、合同等文件。这些举报信息将存储在举报表中，上传的证据文件会单独保存在举报证据表里，并与对应举报记录关联。该设计保证举报信息的完整性和多样性，支持管理员在后续审核中获取充分依据，提升平台对违规行为的发现和响应能力，维护交易环境的公平和安全。
   1.17 管理员审核需求
   需要用到举报表、操作日志表、管理员信息表。
   管理员负责对用户提交的举报进行核实、审核和处理。系统后台为管理员提供举报列表筛选、举报详情查看及证据浏览功能。管理员可基于举报材料做出“通过举报”、“驳回举报”或“要求补充材料”等处理决策，且需填写处理意见。所有操作均实时更新举报表中的状态字段，反映举报的当前处理进度。
   与此同时，系统通过操作日志表对管理员的每一次关键操作进行详细记录，包括操作管理员的唯一 ID、操作类型、所处理的举报编号、具体操作内容以及操作执行时间。该操作留痕机制不仅确保审核流程的透明和规范，还为后续出现纠纷时提供有力的责任追溯依据，帮助平台准确定位问题环节，强化管理员责任意识，提升系统整体的安全性与可信度。
   1.18 权限分配与操作审计需求
   需要用到管理员信息表、操作日志表。
   系统管理员具有比模块管理员更高的权限，这个角色负责统筹管理各个模块管理员（包括分类管理员、举报管理员等）。其主要职责包括：
   • 权限分配：系统管理员可以为新模块管理员分配初始角色及其对应的管理范围，确保其具备相应的操作权限；
   • 权限收回：当模块管理员不再承担相关职责时，系统管理员可以撤销其职权，保证系统权限的动态安全性；
   • 权限修改：在管理过程中，系统管理员可随时根据系统各个模块工作量变化等需求，对模块管理员的角色或管理范围进行调整；
   • 操作审计：系统管理员可通过审计日志表，查看每位模块管理员的操作记录，包括操作类型、操作对象、操作时间、操作详情，从而便于追踪责任，加强管理。
   通过权限管理与审计机制的配合，统筹管理模块管理员，并对其操作进行监督管理，提高整个系统的可管理性。
   1.19 操作留痕机制需求
   需要用到操作日志表。
   通过建立操作留痕机制，管理员的封禁用户、修改权限、处理举报这些敏感操作都将被记录，都将被进行记录，确保系统运行过程中，管理员操作的可追溯性，进而实现管理员的责任可界定性。在日志中，操作管理员的 id、所进行的操作类型、操作的目标用户、具体操作内容、执行操作的时间都将被记录。以此为系统由于管理员的失误出现错误进行责任追溯时，能够拥有有力的数据支撑，进一步提高系统的安全性。
   1.20 数据看板需求
   该功能是一个总体性功能，需要用到商品表、登录日志表、订单表等等。
   比如，通过登录日志表计算用户活跃度、通过订单表获取月度交易量、热销商品等。
   1.21 组织结构
   文档的组织结构如下。
   第一章：系统数据需求分析。
   第二章：概念设计。
   第三章：逻辑设计。
   附录 A：是本文档的图表索引。
2. 概念设计
   大学生常面临旧教材、闲置物品难处理的问题，也常有淘到廉价好物的需求，“变废为宝”的二手交易则是迎合了同学们勤俭节约、低碳环保的生活方式。本系统以服务校园生态为核心，通过创新设计打造透明、高效、安全的校园资源流通平台，重点解决校园内物品共享、二手交易、互助服务等场景痛点，助力构建低碳环保、互助共享的校园生活方式。我们的平台以“便捷性、场景适配、安全性、轻量化、社交化延伸”为设计核心理念，采用极简交互，精准适配校园社区化自由交易场景，通过多重安全机制保障交易，并延伸社交功能，不仅是交易平台，更是校园生活服务入口，致力于构建“高效便捷、安全可靠”的校园交易生态。
   2.1 总体 E-R 图

图 2 1 总体 E-R 图
2.2 模块 E-R 图
我们将整个系统的各个功能分为用户模块、商品模块、交易模块、评价与举报模块、安全与权限模块五个部分，每个模块的功能和数据表具有高度相关。
2.2.1 用户模块 E-R 图

图 2 2 用户模块 E-R 图
2.2.2 商品模块 E-R 图

图 2 3 商品模块 E-R 图
2.2.3 交易模块 E-R 图

图 2 4 交易模块 E-R 图
2.2.4 评价与举报模块 E-R 图

图 2 5 评价与举报模块 E-R 图
2.2.5 安全与权限模块 E-R 图

图 2 6 安全与权限模块 E-R 图

3. 逻辑设计
   用户需通过学号姓名等信息方可注册，系统在收到注册请求后与预存的学生信息表中数据进行匹配，同时与用户表中现有数据比对，确认学生信息无误并且未被已有用户绑定方可成功注册，用户设置的账户密码采用 MD5 加密存储，避免直接在数据库中存储密码明文，确保系统安全性。
   注册成功后用户可以进行邮箱绑定验证，在服务端接收到请求后自动生成一条新的验证实例并保存至邮箱验证表中，用户需在有效时间内提供收到的随机验证码，经过系统与邮箱验证表中信息比对一致后方可成功完成验证。
   登录时，用户输入密码系统校验后，首先同过认证中间件进行 JWT 令牌验证，然后通过审计中间件将本次登录信息存放至登录日志表中，包括登录时间、设备类型。接着风控中间件负责区分风险等级，并写入登录日志表，完成异常行为的处理。
   用户通过平台发布商品，用户所提供的商品的售价、描述等基本信息和发布时间、浏览量等客观信息均作为商品记录的属性，共同存入商品表中。商品表中直接存放商品的最低级（第三级）分类，并通过父子分类的树形结构完成多级分类的管理和查询。
   商品发布后首先根据发布时间设置默认的自动下架时间，之后根据商品品类与浏览量等数据定时计算并动态更新商品的自动下架时间，确保更热门的商品能够保留发布状态更长时间。
   买家可以对想要的商品提出议价请求，卖家可以同意、反对或提出新的价格，议价过程可持续多轮。议价信息记录会增加至议价记录表中，以便信息审查和追踪。若双方对价格无异议，买方可发起购买请求，系统自动创建相应订单记录，写入订单表中并进行管理。买家需在订单创建一定时间内通过系统的虚拟账户完成账户充值和订单支付操作，未在有效时间内完成支付的订单经系统定时检查将被取消。正常的订单完整流程涉及待付款、已付款、已发货、已送达、已完成，系统将根据买家、卖家执行的操作自动更新订单表中的订单状态，以供订单管理使用。订单状态发生变化时，系统会产生新的订单通知记录，并根据所联系的订单，将订单通知传达给参与本订单的买家或卖家。若通知发送失败会进行重试，当失败次数达到一定次数时暂停发送流程，待后续处理或重新发送。
   除直接购买外，用户还可以对商品发起换物请求，若经过协商后双方均同意，可进入换物交易流程。换物交易和正常交易为两种不同的交易，其状态分别通过换物表和订单表管理，二者又共同联系到抽象订单表，便于共同功能所需数据的管理。例如，用户对两种交易均可进行举报反馈，存储举报记录的举报信息表就通过先关联到抽象订单表，再进一步关联到实际订单表的方式管理不同种类交易的举报信息。除举报外，系统同样对交易提供评价反馈，并对评价信息进行存储和管理，实现丰富的交易评价体系。
   若用户的举报被核实，系统会同步更新降低被举报用户的信用分，信用分较低会影响用户上传商品和进行交易。
   系统还设有管理员机制，管理员根据具体角色不同负责管理不同事务，管理员信息记录在管理员表中。管理员属于一种特殊角色，可被赋予到具体的账户。管理员的操作记录同样作为数据存储到审计记录表中，便于溯源管理信息。
   3.1 表的设计
   3.1.1 students 表
   表格 3 1 students 表
   字段名 数据类型 长度 说明 备注
   student_id VARCHAR2 20 学号 PK
   name VARCHAR2 50 姓名 NOT NULL 不为空
   department VARCHAR2 50 所属院系

3.1.2 users 表
表格 3 2 users 表
字段名 数据类型 长度 说明 备注
user_id NUMBER 用户 ID PK
email VARCHAR2 100 绑定邮箱 NOT NULL UNIQUE
credit_score NUMBER (3,1) 用户当前的信用分 默认为 60
password_hash VARCHAR2 128 用户密码 记录的是采用了 MD5 处理后的密码
student_id VARCHAR2 20 学号 FK，依赖于 students 表
NOT NULL UNIQUE

3.1.3 credit_history 表
表格 3 3 credit_history 表
字段名 数据类型 长度 说明 备注
log_id NUMBER 信用日志 ID PK GENERATED [ALWAYS] AS IDENTITY 自增加
user_id NUMBER 用户 ID FK
change_type VARCHAR2 20 变更类型 类型包括（'交易完成','举报处罚','好评奖励'）
new_score NUMBER (3,1) 变更后分值 NOT NULL

3.1.4 login_logs 表
表格 3 4 login_logs 表
字段名 数据类型 长度 说明 备注
log_id NUMBER 登录日志 ID PK
user_id NUMBER 用户 ID FK
ip_address VARCHAR2 45 登录 IP 地址
log_time TIMESTAMP 登录时间
device_type VARCHAR2 设备类型 通过 CHECK 限制为 Mobile/PC 几种取值
risk_level NUMBER 风险等级 通过 CHECK 限制取值：0-正常，1-警告，2-高危

3.1.5 email_verification 表
表格 3 5 email_verification 表
字段名 数据类型 长度 说明 备注
verification_id NUMBER 验证记录 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
user_id NUMBER 关联 users.user_id FK
email VARCHAR2 100 待验证邮箱 NOT NULL 不为空
verification_code VARCHAR2 6 6 位数字验证码
token VARCHAR2 64 加密令牌（用于链接验证）
expire_time TIMESTAMP 过期时间 默认十分钟后失效
is_used NUMBER 是否已使用 DEFAULT 0 缺省为 0

3.1.6 categories 表
表格 3 6 categories 表
字段名 数据类型 长度 说明 备注
category_id NUMBER 分类 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
parent_id NUMBER 父分类 ID FK
name VARCHAR2 50 分类名称 名称格式如"教材/ 计算机科学"
NOT NULL 不为空

3.1.7 products 表
表格 3 7 products 表
字段名 数据类型 长度 说明 备注
product_id NUMBER 商品 ID PK
user_id NUMBER 发布者 ID FK
category_id NUMBER 种类 ID FK
title VARCHAR2 100 商品标题
description CLOB 详细描述
base_price NUMBER (10,2) 基础价格 NOT NULL 不为空
publish_time TIMESTAMP 发布时间 缺省为 NOW()当前时间
view_count NUMBER 浏览量（用于智能延期） 缺省为 0
auto_remove_time TIMESTAMP 自动下架时间
status VARCHAR2 商品状态 状态包含('在售','已下架','交易中')

3.1.8 product_images 表
表格 3 8 product_images 表
字段名 数据类型 长度 说明 备注
image_id NUMBER 图片 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
product_id NUMBER 商品 ID FK
image_url VARCHAR2 200 图片存储路径 NOT NULL 不为空

3.1.9 abstract_orders 表
表格 3 9 orders 表
字段名 数据类型 长度 说明 备注
abstract_order_id NUMBER 抽象订单 ID PK
order_type VARCHAR2 订单类型 通过 CHECK 限制取值：
“normal”，“exchange”

3.1.10 orders 表
表格 3 10 orders 表
字段名 数据类型 长度 说明 备注
order_id NUMBER 订单 ID PK, FK
buyer_id NUMBER 买家 ID FK
seller_id NUMBER 卖家 ID FK
total_amount NUMBER 订单总额
status VARCHAR2 当前状态 通过 CHECK 限制取值：
“待付款”，“已付款”，“已发货”，“已送达”，“已完成”，“已取消”
create_time TIMESTAMP 订单创建时间
expire_time TIMESTAMP 支付超时时间 默认为 30 分钟
final_price NUMBER (10,2) 成交价 含议价结果(合并 order_item 表)

3.1.11 virtual_accounts 表
表格 3 11 virtual_account 表
字段名 数据类型 长度 说明 备注
account_id NUMBER 账户 ID PK
user_id NUMBER 用户 ID FK
balance NUMBER (10,2) 账户余额 默认为 0.00 精确到分

3.1.12 recharge_records 表
表格 3 12 recharge_records 表
字段名 数据类型 长度 说明 备注
recharge_id NUMBER 充值记录 ID PK
user_id NUMBER 用户 ID FK
amount NUMBER (10,2) 充值金额
status VARCHAR2 充值状态 默认为“处理中”。通过 CHECK 限制取值:“处理中”“成功”“失败”
create_time TIMESTAMP 创建时间
complete_time TIMESTAMP 完成时间 成功 / 失败时记录

3.1.13 negotiations 表
表格 3 13 negotiations 表
字段名 数据类型 长度 说明 备注
negotiatio_id NUMBER 议价 ID PK
order_id NUMBER 关联订单 FK
proposed_price NUMBER (10,2) 提议价格
status VARCHAR2 议价状态 通过 CHECK 限制取值:“等待回应”“接受”“拒绝”“反报价”

3.1.14 admins 表
表格 3 14 admins 表
字段名 数据类型 长度 说明 备注
admin_id NUMBER 管理员 ID PK
user_id NUMBER 对应账号 ID FK
role VARCHAR2 角色类型 通过 CHECK 限制取值:
“super”“category_admin”“report_admin”
assigned_category NUMBER 负责的商品分类 使用 CHECK 限制：只有 category_admin 该值有效，其与类型为 NULL
3.1.15 audit_logs 表
表格 3 15 audit_logs 表
字段名 数据类型 长度 说明 备注
log_id NUMBER 审计日志 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
admin_id NUMBER 操作管理员 ID FK
action_type VARCHAR2 操作类型 通过 CHECK 限制取值:“封禁用户”“修改权限”“处理举报”
target_id NUMBER 操作目标 ID 使用 CHECK 限制：该 ID 为用户 ID 或管理员 ID
log_detail CLOB 操作详情
log_time TIMESTAMP 操作时间 DEFALT NOW()自动记录当前时间
3.1.16 exchange_requests 表
表格 3 16 exchange_requests 表
字段名 数据类型 长度 说明 备注
exchange_id NUMBER 换物 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
offer_product_id NUMBER 提供的商品 ID FK
request_product_id NUMBER 请求的商品 ID FK
terms CLOB 换物条件描述
status VARCHAR2 申请状态 通过 CHECK 限制取值:“等待回应”“接受”“拒绝”“反报价”

3.1.17 notification 表
表格 3 17 notification 表
字段名 数据类型 长度 说明 备注
notification_id NUMBER 通知记录 ID PK GENERATED [ALWAYS] AS IDENTITY 自增长
order_id NUMBER 关联订单 ID FK
Content CLOB 通知内容 通知内容需设定模版
send_status VARCHAR2 发送状态 含 ('待发送','成功','失败')三种状态
retry_count NUMBER 重试次数 default 0
last_attempt_time TIMESTAMP 最后尝试时间

3.1.18 review 表
表格 3 18 review 表
字段名 数据类型 长度 说明 备注
review_id VARCHAR2 20 评价编号 PK GENERATED [ALWAYS] AS IDENTITY 自增长
order_id VARCHAR2 20 评价的订单 外码依赖于订单的主码
rating NUMBER 总体评价
desc_accuracy NUMBER(3,0) 描述相符度 评价维度 1
sevice_attitude NUMBER(3,0) 服务态度 评价维度 2
is_anonymous NUMBER 是否匿名 default 0
create_time TIMESTAMP 创建时间
seller_reply CLOB 卖家回复

3.1.19 report 表
表格 3 19 report 表
字段名 数据类型 长度 说明 备注
report_id VARCHAR2 20 举报编号 PK
order_id VARCHAR2 20 评价的订单 外码依赖于订单的主码
type VARCHAR2 举报类型 包括“商品问题”“服务问题”“欺诈”等等
priority NUMBER 2 1-10，表示举报的紧急程度和处理优先级

3.1.20 report_evidence 表
表格 3 20 report_evidence 表
字段名 数据类型 长度 说明 备注
evidence_id VARCHAR2 20 证据编号 PK
report_id VARCHAR2 20 对应的举报 外码依赖于 report 的主码
file_type VARCHAR2 文件类型 包括“图片”“视频”
file_url VARCHAR2 200 文件路径
